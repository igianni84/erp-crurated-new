# Ralph Progress Log
Started: Wed Feb  4 10:35:15 CET 2026

## Codebase Patterns
- UUID primary keys: Use `$table->uuid('id')->primary()` in migrations and `HasUuid` trait in models
- FK to users: Use `$table->foreignId()` (integer) NOT `foreignUuid()` since users table uses integer IDs
- Morphic relationships: Use explicit key names `morphTo('product_reference')` with TWO migration columns: `_type` (string) and `_id` (uuid)
- Soft deletes: Always include `$table->softDeletes()` in migrations and `use SoftDeletes;` trait in models
- Audit fields: Include `created_by`, `updated_by` FKs and use `Auditable` trait
- Enums: String-backed PHP 8.1+ enums in `app/Enums/{Module}/` with `label()`, `color()`, `icon()` methods
- Models: Organized by module in `app/Models/{Module}/`
- Invariant enforcement: Use `boot()` method with `static::saving()` callback

---

## 2026-02-04 - US-001
- What was implemented:
  - Migration `2026_02_04_400001_create_procurement_intents_table.php` with all required fields
  - ProcurementIntent model with morphic relationship to SellableSku/LiquidProduct
  - Three enums: ProcurementTriggerType, SourcingModel, ProcurementIntentStatus
  - Quantity > 0 invariant enforced in boot() method
  - Soft deletes enabled
- Files changed:
  - database/migrations/2026_02_04_400001_create_procurement_intents_table.php (new)
  - app/Models/Procurement/ProcurementIntent.php (new)
  - app/Enums/Procurement/ProcurementTriggerType.php (new)
  - app/Enums/Procurement/SourcingModel.php (new)
  - app/Enums/Procurement/ProcurementIntentStatus.php (new)
- **Learnings for future iterations:**
  - BottleSku in PRD maps to SellableSku model in codebase
  - Morphic relationships need `instanceof` checks before accessing type-specific properties (PHPStan requirement)
  - Use `product_reference_type = 'sellable_skus'` or `'liquid_products'` for the morphic type column
---

## 2026-02-04 - US-002
- What was implemented:
  - Six new enums for Procurement module (3 already existed from US-001)
  - PurchaseOrderStatus: draft, sent, confirmed, closed
  - BottlingPreferenceStatus: pending, partial, complete, defaulted
  - BottlingInstructionStatus: draft, active, executed
  - InboundPackaging: cases, loose, mixed
  - OwnershipFlag: owned, in_custody, pending
  - InboundStatus: recorded, routed, completed
  - All enums follow established pattern with label(), color(), icon() methods
  - Status enums include allowedTransitions() and canTransitionTo() helpers
- Files changed:
  - app/Enums/Procurement/PurchaseOrderStatus.php (new)
  - app/Enums/Procurement/BottlingPreferenceStatus.php (new)
  - app/Enums/Procurement/BottlingInstructionStatus.php (new)
  - app/Enums/Procurement/InboundPackaging.php (new)
  - app/Enums/Procurement/OwnershipFlag.php (new)
  - app/Enums/Procurement/InboundStatus.php (new)
- **Learnings for future iterations:**
  - Enums with status transitions should include `allowedTransitions()` and `canTransitionTo()` methods
  - Include domain-specific helper methods (e.g., `OwnershipFlag::isClarified()`, `InboundStatus::allowsHandOff()`)
  - BottlingPreferenceStatus tracks customer preference collection and supports defaulting
---
