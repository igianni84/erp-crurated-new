# Ralph Progress Log
Started: Tue Feb  3 16:33:41 CET 2026
---

## Codebase Patterns
- PIM models go in `app/Models/Pim/` namespace
- PIM Filament resources go in `app/Filament/Resources/Pim/` namespace
- Use `HasUuid` trait with `$table->uuid('id')->primary()` instead of `$table->id()`
- Use `Auditable` trait with `created_by` and `updated_by` foreign keys
- Use `SoftDeletes` trait with `$table->softDeletes()` for referential integrity
- JSON fields use `'field_name' => 'array'` cast and `KeyValue` form component
- Navigation group for PIM is 'PIM', sort order starts at 1

---

## 2026-02-03 16:56 CET - US-001
- Implemented Wine Master model with all required fields
- Files changed:
  - `database/migrations/2026_02_03_155637_create_wine_masters_table.php` (new)
  - `app/Models/Pim/WineMaster.php` (new)
  - `app/Filament/Resources/Pim/WineMasterResource.php` (new)
  - `app/Filament/Resources/Pim/WineMasterResource/Pages/ListWineMasters.php` (new)
  - `app/Filament/Resources/Pim/WineMasterResource/Pages/CreateWineMaster.php` (new)
  - `app/Filament/Resources/Pim/WineMasterResource/Pages/EditWineMaster.php` (new)
- **Learnings for future iterations:**
  - Patterns discovered: PIM models/resources have their own Pim subdirectory namespace
  - Use `KeyValue` component for JSON regulatory_attributes field
  - Use `TrashedFilter` for soft-deleted models in table filters
  - Table columns: searchable on name/producer/appellation per requirements
---

## 2026-02-03 17:00 CET - US-002
- Implemented Wine Variant model with FK to Wine Master and all required fields
- Files changed:
  - `database/migrations/2026_02_03_160009_create_wine_variants_table.php` (new)
  - `app/Models/Pim/WineVariant.php` (new)
  - `app/Models/Pim/WineMaster.php` (modified - added hasMany relationship)
  - `app/Filament/Resources/Pim/WineVariantResource.php` (new)
  - `app/Filament/Resources/Pim/WineVariantResource/Pages/ListWineVariants.php` (new)
  - `app/Filament/Resources/Pim/WineVariantResource/Pages/CreateWineVariant.php` (new)
  - `app/Filament/Resources/Pim/WineVariantResource/Pages/EditWineVariant.php` (new)
- **Learnings for future iterations:**
  - Use `foreignUuid()` for foreign keys to UUID primary keys (not `foreignId`)
  - For unique constraint across two columns, use `$table->unique(['col1', 'col2'])`
  - Select component with relationship: use `getOptionLabelFromRecordUsing()` for custom labels
  - Navigation sort increments for each resource (WineMaster=1, WineVariant=2)
  - BelongsTo relationship method name should be camelCase singular (e.g., `wineMaster`)
---

## 2026-02-03 17:05 CET - US-003
- Implemented Format model for bottle formats
- Files changed:
  - `database/migrations/2026_02_03_160313_create_formats_table.php` (new)
  - `app/Models/Pim/Format.php` (new)
  - `app/Filament/Resources/Pim/FormatResource.php` (new)
  - `app/Filament/Resources/Pim/FormatResource/Pages/ListFormats.php` (new)
  - `app/Filament/Resources/Pim/FormatResource/Pages/CreateFormat.php` (new)
  - `app/Filament/Resources/Pim/FormatResource/Pages/EditFormat.php` (new)
  - `database/seeders/FormatSeeder.php` (new)
  - `database/seeders/DatabaseSeeder.php` (modified - added FormatSeeder)
- **Learnings for future iterations:**
  - Use `TernaryFilter` for boolean fields in table filters (better UX than checkbox)
  - Use `Toggle` component with `helperText` for boolean form fields
  - Use `firstOrCreate` in seeders with unique field as first argument to avoid duplicates
  - Format volume display: use `formatStateUsing(fn (int $state): string => number_format($state) . ' ml')`
  - Navigation sort for Format = 3 (after WineMaster=1, WineVariant=2)
---
