# Ralph Progress Log
Started: Wed Feb  4 17:27:51 CET 2026
---

## Codebase Patterns
- Use `HasUuid` trait for all models (UUID primary key)
- Use `Auditable` trait for created_by/updated_by tracking
- Use `SoftDeletes` trait for all business models
- UUID foreign keys: `$table->uuid('field_id')` then `$table->foreign('field_id')->references('id')->on('table')`
- Integer FK to users: `$table->foreignId('created_by')->nullable()->constrained('users')->nullOnDelete()`
- Enums: backed string enums with `label()`, `color()`, `icon()` helpers
- Status enum values as Filament colors: success/danger/warning/info/gray
- Model boot() method for validation guards on updating
- Index names limited to 64 chars (MySQL) - use custom names for compound indexes

---

## 2026-02-04 - US-C001
- **What was implemented:** ShippingOrder model, migration, and related enums
- **Files changed:**
  - `database/migrations/2026_02_04_200000_create_shipping_orders_table.php` (new)
  - `app/Models/Fulfillment/ShippingOrder.php` (new)
  - `app/Enums/Fulfillment/ShippingOrderStatus.php` (new)
  - `app/Enums/Fulfillment/PackagingPreference.php` (new)
  - `database/migrations/2026_02_04_100001_create_inbound_batches_table.php` (fixed index name)
- **Learnings for future iterations:**
  - ShippingOrderStatus enum has `canTransitionTo()` method for workflow validation
  - Status workflow: draft→planned→picking→shipped→completed, any→cancelled/on_hold
  - OnHold stores previous_status for restoration
  - hasMany relationships to future models removed to avoid phpstan errors
  - Run migrations first to discover DB errors before typecheck
---

## 2026-02-04 - US-C002 + US-C005
- **What was implemented:** Shipment model, migration, ShipmentStatus enum
- **Files changed:**
  - `database/migrations/2026_02_04_210000_create_shipments_table.php` (new)
  - `app/Models/Fulfillment/Shipment.php` (new)
  - `app/Enums/Fulfillment/ShipmentStatus.php` (new)
  - `app/Models/Fulfillment/ShippingOrder.php` (added shipments() HasMany relationship)
- **Learnings for future iterations:**
  - Shipment model enforces immutability of `shipped_bottle_serials` after confirmation via boot() updating guard
  - ShipmentStatus terminal states: delivered, failed
  - Shipment requires shipping_order_id (NOT NULL) - enforces no standalone shipments
  - JSON field `shipped_bottle_serials` stores bottle serials as immutable record
  - US-C005 (ShipmentStatus enum) was implemented together with US-C002 since required for model
---

## 2026-02-04 - US-C003
- **What was implemented:** ShippingOrderLine model and migration
- **Files changed:**
  - `database/migrations/2026_02_04_220000_create_shipping_order_lines_table.php` (new)
  - `app/Models/Fulfillment/ShippingOrderLine.php` (new)
  - `app/Models/Fulfillment/ShippingOrder.php` (added lines() HasMany relationship)
- **Learnings for future iterations:**
  - ShippingOrderLine enforces allocation_id immutability via boot() updating guard
  - Status uses string constants until ShippingOrderLineStatus enum (US-C007) is implemented
  - The cases table is referenced as `cases` not `inventory_cases` (model is InventoryCase)
  - 1 voucher = 1 line = 1 bottle invariant enforced via model design
  - early_binding_serial for Module D personalization, bound_bottle_serial for late binding from WMS
---
