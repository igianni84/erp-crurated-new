## Codebase Patterns

- Modular structure: Models in app/Models/{Module}/, Filament in app/Filament/Resources/{Module}/
- Use `./vendor/bin/pint --test` to check code style without making changes
- Laravel Pint is pre-configured in Laravel 12 as the default linter
- Use `php artisan test` to run all tests
- .env is configured for MySQL but falls back works with SQLite for testing
- MySQL 9.6.0 runs via `brew services start mysql`, CLI at `/opt/homebrew/bin/mysql`
- Use `php artisan db:show` to check database connection status
- Database `crurated_erp` uses utf8mb4_unicode_ci collation
- Use `composer quality` to run all quality checks (lint, analyse, test)
- Use `composer lint` to auto-fix code style, `composer lint:test` to check only
- PHPStan/Larastan configured at level 5 via phpstan.neon
- Pre-commit hook runs lint:test on staged PHP files
- Traits: HasUuid (UUID PKs), Auditable (created_by/updated_by), HasLifecycleStatus (status management)
- LifecycleStatus enum: Draft, Active, Inactive, Archived - with label(), color(), icon() helpers
- Filament v3.3.47 is the current stable version (PRD mentions "Filament 5" but that doesn't exist)
- Filament panel providers live in app/Providers/Filament/ and are registered in bootstrap/providers.php
- Filament assets are published to public/css/filament/ and public/js/filament/
- Use `php artisan filament:install --panels` to install Filament and create admin panel
- PHPUnit 11.5.3 configured with SQLite in-memory for tests (phpunit.xml)
- Unit tests: extend PHPUnit\Framework\TestCase; Feature tests: extend Tests\TestCase
- UserFactory available at database/factories/UserFactory.php

---

# Progress Log

## 2026-02-03 - US-001
- What was implemented:
  - Initialized Laravel 12.49.0 project using `laravel new`
  - Configured .env and .env.example for MySQL (crurated_erp database)
  - Updated composer.json project name to crurated/erp
  - Initialized git repository on ralph/infrastructure branch
  - Added additional entries to .gitignore (SQLite, .last-branch, temp files)
- Files changed:
  - .env, .env.example (MySQL configuration)
  - .gitignore (added SQLite, temp files)
  - composer.json (project name)
  - All Laravel 12 scaffold files
- **Learnings for future iterations:**
  - Laravel 12 comes with Pint pre-installed for linting
  - Default database is SQLite, need to explicitly configure MySQL
  - `php artisan serve` starts on port 8000 by default
  - Laravel 12 has built-in test infrastructure (PHPUnit + example tests)
---

## 2026-02-03 - US-002
- What was implemented:
  - Installed MySQL 9.6.0 via Homebrew (`brew install mysql`)
  - Started MySQL service (`brew services start mysql`)
  - Created `crurated_erp` database with utf8mb4_unicode_ci collation
  - Verified Laravel .env configuration connects correctly
  - Ran `php artisan migrate` successfully (users, cache, jobs tables)
  - Verified all tables and columns use snake_case naming convention
- Files changed:
  - No code files changed - this was database infrastructure setup
  - prd.json (marked US-002 as passing)
  - progress.txt (this log)
- **Learnings for future iterations:**
  - MySQL CLI on macOS is at `/opt/homebrew/bin/mysql`
  - Use `brew services start mysql` to start the MySQL daemon
  - Use `php artisan db:show` to verify database connection and see stats
  - Laravel 12 default migrations create: users, cache, cache_locks, jobs, job_batches, failed_jobs, password_reset_tokens, sessions, migrations tables
  - All Laravel migrations follow snake_case convention by default
---

## 2026-02-03 - US-003
- What was implemented:
  - Verified Laravel Pint v1.27.0 already installed
  - Installed Larastan v3.9.2 (PHPStan for Laravel) at level 5
  - Created phpstan.neon configuration file
  - Added composer scripts: lint, lint:test, analyse, quality
  - Created pre-commit hook (.git/hooks/pre-commit) for automated lint checks
  - Verified all quality checks pass (pint, phpstan, tests)
- Files changed:
  - composer.json (added larastan dependency, new scripts)
  - composer.lock (updated dependencies)
  - phpstan.neon (new file - PHPStan configuration)
  - .git/hooks/pre-commit (new file - lint hook)
  - prd.json (marked US-003 as passing)
  - progress.txt (this log)
- **Learnings for future iterations:**
  - PHPStan v2+ removed `checkMissingIterableValueType` option
  - Larastan provides Laravel-specific PHPStan extensions
  - Use `--memory-limit=512M` for PHPStan on larger projects
  - Pre-commit hooks must be executable (`chmod +x`)
  - Composer script `quality` runs all checks in sequence for CI/CD
---

## 2026-02-03 - US-004
- What was implemented:
  - Created modular directory structure for the ERP
  - app/Models/Pim/ for PIM (Product Information Management) module models
  - app/Filament/Resources/Pim/ for PIM-related Filament resources
  - app/Enums/ for application enumerations
  - app/Services/ for business logic services
  - app/Traits/ for reusable traits
  - Added .gitkeep files to track empty directories in git
  - Verified PSR-4 autoloading via existing App\\ namespace in composer.json
- Files changed:
  - app/Models/Pim/.gitkeep (new)
  - app/Filament/Resources/Pim/.gitkeep (new)
  - app/Enums/.gitkeep (new)
  - app/Services/.gitkeep (new)
  - app/Traits/.gitkeep (new)
  - prd.json (marked US-004 as passing)
  - progress.txt (this log)
- **Learnings for future iterations:**
  - Laravel's PSR-4 autoload with App\\ prefix auto-maps all app/ subdirectories
  - Use .gitkeep files to track empty directories in git
  - Namespace convention: App\Models\Pim\, App\Enums\, App\Services\, App\Traits\
  - Filament resources go in app/Filament/Resources/ with subdirs for modules
---

## 2026-02-03 - US-005
- What was implemented:
  - Created HasUuid trait for UUID as primary key functionality
  - Created Auditable trait for tracking created_by/updated_by
  - Created HasLifecycleStatus trait for lifecycle status management
  - Created LifecycleStatus enum with Filament UI helpers (label, color, icon)
  - Updated README with comprehensive documentation for all traits
  - Updated phpstan.neon to ignore trait.unused errors (traits are designed for future use)
- Files changed:
  - app/Traits/HasUuid.php (new)
  - app/Traits/Auditable.php (new)
  - app/Traits/HasLifecycleStatus.php (new)
  - app/Enums/LifecycleStatus.php (new)
  - README.md (replaced default Laravel README with project-specific docs)
  - phpstan.neon (added ignoreErrors for trait.unused)
  - prd.json (marked US-005 as passing)
  - progress.txt (this log)
- **Learnings for future iterations:**
  - PHPStan reports trait.unused for traits not currently used - add ignoreErrors for this
  - Traits need both boot{TraitName} and initialize{TraitName} methods for proper setup
  - Eloquent model traits can use initializeXxx() to set properties like keyType, incrementing
  - Use `$this->belongsTo(\App\Models\User::class, 'foreign_key')` for explicit FK in relations
  - LifecycleStatus enum provides: Draft, Active, Inactive, Archived with UI helpers
  - Traits with scopes need Builder<static> return types for PHPStan
---

## 2026-02-03 - US-006
- What was implemented:
  - Installed Filament v3.3.47 via composer (current stable version)
  - Ran `php artisan filament:install --panels` to create admin panel
  - AdminPanelProvider created in app/Providers/Filament/
  - Configured custom theme with Crurated ERP branding
  - Set Indigo as primary color with professional color scheme (Rose for danger, Slate for gray, etc.)
  - Published all Filament assets (CSS and JS) to public/
  - Verified /admin routes are registered and show login page
- Files changed:
  - composer.json (added filament/filament dependency)
  - composer.lock (added 26 Filament-related packages)
  - bootstrap/providers.php (registered AdminPanelProvider)
  - app/Providers/Filament/AdminPanelProvider.php (new - panel configuration)
  - public/css/filament/ (new - Filament CSS assets)
  - public/js/filament/ (new - Filament JS assets)
  - prd.json (marked US-006 as passing)
  - progress.txt (this log)
- **Learnings for future iterations:**
  - Filament v3.x is the current stable version (not v5 as PRD mentioned)
  - Use `filament:install --panels` to set up the admin panel
  - Panel provider is auto-registered in bootstrap/providers.php
  - Colors are configured via Color enum: Color::Indigo, Color::Rose, etc.
  - Use ->brandName() to set the application name in the admin panel
  - Admin panel is accessible at /admin with login page at /admin/login
  - Filament auto-discovers resources, pages, and widgets from app/Filament/
---

## 2026-02-03 - US-007
- What was implemented:
  - Verified PHPUnit 11.5.3 is pre-configured by Laravel 12 scaffold
  - Verified SQLite in-memory database is configured in phpunit.xml (DB_CONNECTION=sqlite, DB_DATABASE=:memory:)
  - Verified base TestCase in tests/TestCase.php extends BaseTestCase
  - Verified UserFactory exists in database/factories/UserFactory.php
  - Ran `php artisan test` - 2 tests pass (Unit\ExampleTest, Feature\ExampleTest)
  - Ran `composer quality` - all checks pass (lint, analyse, test)
- Files changed:
  - prd.json (marked US-007 as passing)
  - progress.txt (this log)
- **Learnings for future iterations:**
  - Laravel 12 comes with complete PHPUnit infrastructure out of the box
  - phpunit.xml includes all necessary test env vars: SQLite in-memory, array cache, sync queue, null broadcast
  - TestCase at tests/TestCase.php is the base class for feature tests
  - Unit tests can extend PHPUnit\Framework\TestCase directly for isolation
  - Feature tests should extend Tests\TestCase to get Laravel app context
  - UserFactory is ready to use with name, email, password, remember_token fields
  - Use composer scripts: `test` to run tests, `quality` to run all checks
---

## 2026-02-03 - US-008
- What was implemented:
  - Updated .env.example with comprehensive environment variables
  - Added comments explaining recommended values for Development, Staging, and Production
  - Configured logging: single for dev, daily for staging/prod, slack alerts for prod
  - Configured cache: file for dev (no setup), database for staging, redis for prod
  - Configured queue: sync for dev (immediate execution), database/redis for staging/prod
  - Updated README with complete environment setup documentation
  - Added queue worker commands and Supervisor recommendation
- Files changed:
  - .env.example (completely rewritten with comprehensive config and comments)
  - README.md (added "Environment Configuration" section)
  - prd.json (marked US-008 as passing)
  - progress.txt (this log)
- **Learnings for future iterations:**
  - Laravel 12 default cache is database, default queue is database
  - Use CACHE_STORE=file for dev (no external dependencies needed)
  - Use QUEUE_CONNECTION=sync for dev (easier debugging, jobs run immediately)
  - LOG_STACK can be comma-separated for multiple channels: daily,slack
  - AWS_DEFAULT_REGION=eu-west-1 is appropriate for European users (Crurated)
  - BCRYPT_ROUNDS defaults to 12, can increase to 14 for production security
  - SESSION_ENCRYPT=true recommended for production with sensitive data
---

