# Ralph Progress Log
Started: Wed Feb  4 08:12:32 CET 2026
---

## Codebase Patterns
- Use `HasUuid` trait for UUID primary keys with `$table->uuid('id')->primary()` in migrations
- Use `Auditable` trait with `created_by`/`updated_by` columns and `auditLogs()` MorphMany relationship
- Use `SoftDeletes` trait with `$table->softDeletes()` in migrations
- Customer module enums go in `App\Enums\Customer\` namespace
- Customer module models go in `App\Models\Customer\` namespace
- Enums need `label()`, `color()`, and `icon()` methods for Filament compatibility
- Migration naming: `YYYY_MM_DD_XXXXXX_create_table_name_table.php`
- Use `foreignId()->constrained()->nullOnDelete()` for FK references to users table
- Use `foreignUuid()->constrained()->cascadeOnDelete()` for FK references to UUID tables (Module K uses UUIDs)
- Filament Resources for Customer module go in `App\Filament\Resources\Customer\` namespace
- For PHPStan on Filament bulk actions, add `/** @var Collection<int, ModelName> $records */` PHPDoc before each() call

---

## 2026-02-04 - US-001
- What was implemented:
  - Created `PartyType` enum (individual, legal_entity) with label/color/icon methods
  - Created `PartyStatus` enum (active, inactive) with label/color/icon methods
  - Created `Party` model with HasUuid, Auditable, SoftDeletes traits
  - Created migration for `parties` table with unique constraint on (tax_id, jurisdiction)
  - Created `PartyRole` stub model for relationship placeholder (full implementation in US-002)
- Files changed:
  - app/Enums/Customer/PartyType.php (new)
  - app/Enums/Customer/PartyStatus.php (new)
  - app/Models/Customer/Party.php (new)
  - app/Models/Customer/PartyRole.php (new - stub)
  - database/migrations/2026_02_04_390000_create_parties_table.php (new)
- **Learnings for future iterations:**
  - Customer module uses `App\Enums\Customer\` and `App\Models\Customer\` namespaces
  - Migration sequence for Module K starts at 390000
  - PartyRole stub created to satisfy Party relationship, will be completed in US-002
---

## 2026-02-04 - US-002
- What was implemented:
  - Created `PartyRoleType` enum (customer, supplier, producer, partner) with label/color/icon methods
  - Completed `PartyRole` model with HasUuid, Auditable traits and role type casting
  - Created migration for `party_roles` table with FK to parties and unique constraint on (party_id, role)
  - Updated `Party` model with addRole/removeRole methods and role checking helpers (isCustomer, isSupplier, isProducer, isPartner)
- Files changed:
  - app/Enums/Customer/PartyRoleType.php (new)
  - app/Models/Customer/PartyRole.php (updated from stub)
  - app/Models/Customer/Party.php (updated - added role helpers)
  - database/migrations/2026_02_04_390001_create_party_roles_table.php (new)
- **Learnings for future iterations:**
  - Use `foreignUuid()->constrained()->cascadeOnDelete()` for FK references to UUID tables (vs foreignId for int tables)
  - Migration sequence continues: 390001 for party_roles
  - Party model uses union type `PartyRoleType|string` to accept both enum and string values for backward compatibility
---

## 2026-02-04 - US-003
- What was implemented:
  - Created `PartyResource` Filament resource in `App\Filament\Resources\Customer` namespace
  - List view with columns: legal_name, party_type (badge), roles (badges), jurisdiction, status (badge), tax_id, vat_number, updated_at
  - Filters: party_type, role (with custom query for relationship), status, jurisdiction (dynamic), TrashedFilter
  - Search on: legal_name, tax_id, vat_number
  - Bulk actions: activate, deactivate with confirmation
  - CRUD pages: ListParties, CreateParty, ViewParty, EditParty
  - Added "Customers" navigation group to AdminPanelProvider
- Files changed:
  - app/Providers/Filament/AdminPanelProvider.php (updated - added Customers navigation group)
  - app/Filament/Resources/Customer/PartyResource.php (new)
  - app/Filament/Resources/Customer/PartyResource/Pages/ListParties.php (new)
  - app/Filament/Resources/Customer/PartyResource/Pages/CreateParty.php (new)
  - app/Filament/Resources/Customer/PartyResource/Pages/ViewParty.php (new)
  - app/Filament/Resources/Customer/PartyResource/Pages/EditParty.php (new)
- **Learnings for future iterations:**
  - Filament Resources in Customer module go in `App\Filament\Resources\Customer\` namespace
  - Use `->with('roles')` in `getEloquentQuery()` to eager load relationships for list display
  - For bulk actions with Collection, use PHPDoc annotation `/** @var Collection<int, Model> $records */` before the each() call to satisfy PHPStan
  - Role filter needs custom query using `whereHas()` to filter by relationship
  - Navigation groups must be defined in AdminPanelProvider's `navigationGroups()` array
---
