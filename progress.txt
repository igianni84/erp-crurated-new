# Ralph Progress Log
Started: Wed Feb  4 14:00:43 CET 2026

## Codebase Patterns
- Use `$table->uuid('id')->primary()` for model primary keys with HasUuid trait
- Models use Auditable trait with created_by/updated_by foreign keys to users
- Enums follow pattern: value cases with label(), color(), icon() methods
- Inventory module: app/Models/Inventory/, app/Enums/Inventory/
- Module B branch is based on ralph/module-a-allocations branch

---

## 2026-02-04 - US-B001
- **Implemented**: Location model as base for physical storage management
- **Files created**:
  - app/Enums/Inventory/LocationType.php (5 location types with label/color/icon methods)
  - app/Enums/Inventory/LocationStatus.php (3 statuses with operational methods)
  - app/Models/Inventory/Location.php (HasUuid, Auditable, SoftDeletes)
  - database/migrations/2026_02_04_100000_create_locations_table.php
- **Learnings for future iterations**:
  - Location model relationships to InboundBatch, SerializedBottle, InventoryCase were deferred as those models don't exist yet
  - The serialization_authorized flag is key for US-B022 (serialization location blocker)
  - LocationStatus.canReceiveInventory() and canDispatchInventory() will be used by movement validation
---

## 2026-02-04 - US-B002
- **Implemented**: 8 inventory-related enums for Module B
- **Files created**:
  - app/Enums/Inventory/InboundBatchStatus.php (pending_serialization, partially_serialized, fully_serialized, discrepancy)
  - app/Enums/Inventory/BottleState.php (stored, reserved_for_picking, shipped, consumed, destroyed, missing)
  - app/Enums/Inventory/CaseIntegrityStatus.php (intact, broken)
  - app/Enums/Inventory/MovementType.php (internal_transfer, consignment_placement, consignment_return, event_shipment, event_consumption)
  - app/Enums/Inventory/MovementTrigger.php (wms_event, erp_operator, system_automatic)
  - app/Enums/Inventory/OwnershipType.php (crurated_owned, in_custody, third_party_owned)
  - app/Enums/Inventory/ConsumptionReason.php (event_consumption, sampling, damage_writeoff)
  - app/Enums/Inventory/DiscrepancyResolution.php (shortage, overage, damage, other)
- **Learnings for future iterations**:
  - LocationType and LocationStatus were already created in US-B001
  - Each enum includes helper methods beyond label/color/icon (e.g., canStartSerialization(), isAvailableForFulfillment())
  - InboundBatchStatus.canStartSerialization() will be key for serialization flow (US-B020-B023)
  - BottleState.isAvailableForFulfillment() and isTerminal() will be used by inventory service
  - CaseIntegrityStatus.canHandleAsUnit() will prevent operations on broken cases
  - OwnershipType.canConsumeForEvents() enforces only crurated_owned items can be consumed
---

## 2026-02-04 - US-B003
- **Implemented**: InboundBatch model as physical receipt record bridging procurement to serialized inventory
- **Files created**:
  - app/Models/Inventory/InboundBatch.php (HasUuid, Auditable, SoftDeletes)
  - database/migrations/2026_02_04_100001_create_inbound_batches_table.php
- **Relationships**:
  - belongsTo Location (receiving_location_id) - where batch is received
  - belongsTo Allocation (allocation_id) - preserves allocation lineage
  - morphTo productReference - polymorphic reference to wine product
- **Key fields**:
  - source_type (producer/supplier/transfer)
  - quantity_expected vs quantity_received for discrepancy tracking
  - serialization_status (uses InboundBatchStatus enum)
  - ownership_type (uses OwnershipType enum)
- **Learnings for future iterations**:
  - InboundBatch.allocation_id is the source of allocation lineage for all SerializedBottles created from it
  - getRemainingUnserializedAttribute() will need to count SerializedBottles when that model exists
  - canStartSerialization() checks both status and location.canSerialize()
  - hasDiscrepancy() compares expected vs received quantities
  - procurement_intent_id FK is nullable since ProcurementIntent model doesn't exist yet (Module D)
---
